open Options
open Format

let tag_table = Hashtbl.create 100

let () =
  List.iter (fun (tag, sint, otag) ->
    let str = sprintf  "[1;%dm" sint in
    Hashtbl.add tag_table tag (str, z)
  )
  [
    (* Tag    Shell int  Opposite Tag    *)
    "fg_red",       31, "fg_white";
    "fg_yellow",    33, "fg_white";
  ]

let open_tag = function
  | Format.String_tag s   -> (
        try let ostr, _ = Hashtbl.find tag_table s in ostr
        with Not_found -> ""
      )
  | _ -> ""

let close_tag = function
  | Format.String_tag s   -> (
        try let _, cstr = Hashtbl.find tag_table s in cstr
        with Not_found -> ""
      )
  | _                     -> ""

let activate_color_tag fmt =
  pp_set_tags fmt true;
  pp_set_formatter_stag_functions fmt
  {
    mark_open_stag  = open_tag;
    mark_close_stag = close_tag;
  }

let () =
  activate_color_tag Format.err_formatter;
  activate_color_tag Format.std_formatter

let fg_red =
  if no_color then "" else

let fg_yellow =
  if no_color then "" else "[1;33m"
